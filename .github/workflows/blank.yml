name: Get ServiceNow Change Request
on:
  push:
    branches: [ main ]  # Trigger on push, or adapt (e.g., workflow_dispatch for manual)

jobs:
  get-change:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get Change Request
        uses: ServiceNow/servicenow-devops-get-change@v5.1.0
        with:
          devops-integration-user-name: ${{ secrets.SN_DEVOPS_USER }}  # Username of your dedicated user (e.g., github-devops-user)
          devops-integration-user-password: ${{ secrets.SN_DEVOPS_PASSWORD }}  # Associated password
          instance-url: ${{ secrets.SN_INSTANCE_URL }}  # URL of your instance (e.g., https://louisvuittondev.service-now.com)
          tool-id: ${{ secrets.SN_ORCHESTRATION_TOOL_ID }}  # Sys_id of your custom DevOps integration (e.g., github-actions-custom)
          context-github: ${{ toJSON(github) }}  # Auto-generated GitHub context
          change-details: '{"build_number":"21","pipeline_name":"ARGOCD_Deployment","stage_name":"Create_Standard_Change","attempt_number":"1"}'  # JSON to identify/create the change; adapt to keys like build_number, pipeline_name (based on your CI/CD)

      # Optional: Use outputs for the rest of the workflow
      - name: Echo Change Number
        run: echo "Change Request Number:" ${{ steps.get-change.outputs.change-request-number }}
